<!DOCTYPE html>
<html>
<head>
  <title>Study Timer</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 2em; }
    #timer { font-size: 3em; margin: 1em 0; }
    button, input { font-size: 1em; margin: 0.5em; padding: 0.4em 1em; }
    #history { margin-top: 2em; text-align: left; max-width: 400px; margin: 2em auto; }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js"></script>
</head>
<body>
  <h1>‚è≥ Study Timer</h1>

  <!-- Login Section -->
  <div id="login">
    <h2>Login</h2>
    <input id="email" type="email" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p>Don‚Äôt have an account? <button onclick="showRegister()">Register</button></p>
  </div>

  <!-- Registration Section -->
  <div id="register" style="display:none;">
    <h2>Register</h2>
    <input id="reg-email" type="email" placeholder="Email"><br>
    <input id="reg-password" type="password" placeholder="Password"><br>
    <button onclick="register()">Sign Up</button>
    <p>Already registered? <button onclick="showLogin()">Back to Login</button></p>
  </div>

  <!-- Timer App -->
  <div id="app" style="display:none;">
    <div id="timer">00:00:00</div>
    <button onclick="startTimer()">Start</button>
    <button onclick="stopTimer()">Stop</button>
    <button onclick="resetTimer()">Reset</button>

    <div id="history">
      <h2>üìã Your History</h2>
      <ul id="sessionList"></ul>
    </div>
  </div>

  <script>
    // üîß Replace with your Firebase config
    const firebaseConfig = {
    apiKey: "AIzaSyDIhykRWILcAf_8d1EBaY85ktt7cQrRzMQ",
    authDomain: "yuvrajtimer.firebaseapp.com",
    projectId: "yuvrajtimer",
    storageBucket: "yuvrajtimer.firebasestorage.app",
    messagingSenderId: "680357794474",
    appId: "1:680357794474:web:91e3bcae4d84e7a1fe36d3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let userId;
    let timerInterval;
    let seconds = 0;

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(user => {
          userId = user.user.uid;
          showApp();
          getHistory();
        })
        .catch(err => {
          alert("Login failed: " + err.message);
        });
    }

    function register() {
      const email = document.getElementById("reg-email").value;
      const password = document.getElementById("reg-password").value;
      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(user => {
          alert("‚úÖ Registered! You can now log in.");
          showLogin();
        })
        .catch(err => {
          alert("Registration failed: " + err.message);
        });
    }

    function showRegister() {
      document.getElementById("login").style.display = "none";
      document.getElementById("register").style.display = "block";
    }

    function showLogin() {
      document.getElementById("register").style.display = "none";
      document.getElementById("login").style.display = "block";
    }

    function showApp() {
      document.getElementById("login").style.display = "none";
      document.getElementById("register").style.display = "none";
      document.getElementById("app").style.display = "block";
    }

    function startTimer() {
      if (!timerInterval) {
        timerInterval = setInterval(() => {
          seconds++;
          updateDisplay();
        }, 1000);
      }
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
      const duration = formatTime(seconds);
      saveSession(duration);
    }

    function resetTimer() {
      stopTimer();
      seconds = 0;
      updateDisplay();
    }

    function updateDisplay() {
      document.getElementById("timer").textContent = formatTime(seconds);
    }

    function formatTime(sec) {
      const h = String(Math.floor(sec / 3600)).padStart(2, '0');
      const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
      const s = String(sec % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    async function saveSession(duration) {
      await db.collection("users").doc(userId).collection("sessions").add({
        duration,
        timestamp: new Date().toISOString(),
        device: navigator.userAgent
      });
      getHistory();
    }

    async function getHistory() {
      const snapshot = await db.collection("users").doc(userId).collection("sessions")
        .orderBy("timestamp", "desc").get();
      const list = document.getElementById("sessionList");
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.duration} on ${new Date(data.timestamp).toLocaleString()}`;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>
